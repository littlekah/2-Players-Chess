<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xadrez</title>
<style>
body { background:#0d1117; color:#fff; font-family:"Poppins",sans-serif; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; }
h1 { margin-bottom:10px; font-size:2em; color:#58a6ff; }
#board { display:grid; grid-template-columns:repeat(8,70px); grid-template-rows:repeat(8,70px); border:3px solid #58a6ff; box-shadow:0 0 20px #58a6ff50; }
.square { width:70px; height:70px; display:flex; align-items:center; justify-content:center; font-size:40px; cursor:pointer; user-select:none; position:relative; transition: background 0.2s; }
.light { background-color:#e0c097; }
.dark { background-color:#7b4b25; }
.highlight { outline:3px solid #00ffcc; }
.possible-move { background-color: rgba(0,255,204,0.4); border-radius:50%; width:50%; height:50%; pointer-events:none; position:absolute; animation: pulse 1s infinite; }
@keyframes pulse { 0%{transform:scale(0.8);opacity:0.7;}50%{transform:scale(1);opacity:1;}100%{transform:scale(0.8);opacity:0.7;} }
#turn { margin-top:10px; font-size:1.2em; }
#restart { margin-top:10px; padding:8px 16px; background-color:#58a6ff; border:none; border-radius:6px; color:#0d1117; font-weight:bold; cursor:pointer; transition:0.2s; }
#restart:hover { background-color:#00ffcc; }
#promotion {
  display:none;
  position:fixed;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  background:#161b22;
  border:2px solid #58a6ff;
  border-radius:10px;
  padding:15px;
  box-shadow:0 0 20px #58a6ff90;
  text-align:center;
}
#promotion button {
  font-size:30px;
  margin:5px;
  cursor:pointer;
  background:none;
  border:none;
  color:#fff;
  transition:transform 0.2s;
}
#promotion button:hover { transform:scale(1.2); color:#00ffcc; }
@media(max-width:600px){#board{grid-template-columns:repeat(8,45px);grid-template-rows:repeat(8,45px);}.square{width:45px;height:45px;font-size:28px;}}
.piece-move { transition: transform 0.3s ease; }
</style>
</head>
<body>
<h1>♟️ Xadrez</h1>
<div id="board"></div>
<div id="turn">Vez das brancas ⚪</div>
<button id="restart">🔄 Reiniciar Partida</button>

<div id="promotion">
  <h3>Escolha a peça para promoção</h3>
  <div id="promoButtons"></div>
</div>

<script>
const board=document.getElementById("board"),
turnText=document.getElementById("turn"),
restartBtn=document.getElementById("restart"),
promotionDiv=document.getElementById("promotion"),
promoButtons=document.getElementById("promoButtons");

let selected=null,currentPlayer="white",gameOver=false,promoPos=null;

const initialBoard=[
  ["♜","♞","♝","♛","♚","♝","♞","♜"],
  ["♟","♟","♟","♟","♟","♟","♟","♟"],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["","","","","","","",""],
  ["♙","♙","♙","♙","♙","♙","♙","♙"],
  ["♖","♘","♗","♕","♔","♗","♘","♖"]
];
let boardState=JSON.parse(JSON.stringify(initialBoard));

function getColor(piece){
  if(!piece) return null;
  return "♙♖♘♗♕♔".includes(piece)?"white":"black";
}

function renderBoard(){
  board.innerHTML="";
  for(let i=0;i<8;i++){
    for(let j=0;j<8;j++){
      const square=document.createElement("div");
      square.classList.add("square",(i+j)%2===0?"light":"dark");
      square.dataset.row=i;
      square.dataset.col=j;
      const piece=boardState[i][j];
      if(piece){
        const span=document.createElement("span");
        span.textContent=piece;
        span.classList.add("piece-move");
        square.appendChild(span);
      }
      square.onclick=()=>handleClick(i,j);
      board.appendChild(square);
    }
  }
}

function handleClick(row,col){
  if(gameOver)return;
  const piece=boardState[row][col];
  if(selected){
    const [sr,sc]=selected;
    if(isValidMove(sr,sc,row,col)){
      const target=boardState[row][col];
      const pieceColor=getColor(boardState[sr][sc]);
      const targetColor=getColor(target);
      if(targetColor===pieceColor)return;
      if(target==="♚"||target==="♔"){
        alert(`${currentPlayer==="white"?"Brancas ⚪":"Pretas ⚫"} venceram!`);
        gameOver=true;
      }
      boardState[row][col]=boardState[sr][sc];
      boardState[sr][sc]="";
      
      // Promoção
      if((boardState[row][col]==="♙"&&row===0)||(boardState[row][col]==="♟"&&row===7)){
        promoPos=[row,col];
        openPromotion(boardState[row][col]);
        return;
      }

      selected=null;
      currentPlayer=currentPlayer==="white"?"black":"white";
      turnText.textContent=`Vez das ${currentPlayer==="white"?"brancas ⚪":"pretas ⚫"}`;
      renderBoard();
    } else {selected=null; renderBoard();}
  } else if(piece && getColor(piece)===currentPlayer){
    selected=[row,col];
    document.querySelectorAll(".square").forEach(sq=>sq.classList.remove("highlight"));
    const moves=getMoves(row,col);
    moves.forEach(m=>{
      const targetSquare=board.children[m[0]*8+m[1]];
      const dot=document.createElement("div");
      dot.classList.add("possible-move");
      targetSquare.appendChild(dot);
    });
  }
}

function openPromotion(piece){
  promotionDiv.style.display="block";
  promoButtons.innerHTML="";
  const isWhite=getColor(piece)==="white";
  const options=isWhite?["♕","♖","♗","♘"]:["♛","♜","♝","♞"];
  options.forEach(opt=>{
    const btn=document.createElement("button");
    btn.textContent=opt;
    btn.onclick=()=>{
      boardState[promoPos[0]][promoPos[1]]=opt;
      promotionDiv.style.display="none";
      promoPos=null;
      currentPlayer=currentPlayer==="white"?"black":"white";
      turnText.textContent=`Vez das ${currentPlayer==="white"?"brancas ⚪":"pretas ⚫"}`;
      renderBoard();
    };
    promoButtons.appendChild(btn);
  });
}

function isValidMove(sr,sc,tr,tc){
  if(sr===tr && sc===tc) return false;
  const piece=boardState[sr][sc];
  const target=boardState[tr][tc];
  const pieceColor=getColor(piece);
  const targetColor=getColor(target);
  if(targetColor===pieceColor) return false;
  const dr=tr-sr,dc=tc-sc;
  switch(piece){
    case"♙":if(dc===0&&!target&&((dr===-1)||(dr===-2&&sr===6&&!boardState[sr-1][sc])))return true;
             if(Math.abs(dc)===1&&dr===-1&&targetColor==="black")return true; break;
    case"♟":if(dc===0&&!target&&((dr===1)||(dr===2&&sr===1&&!boardState[sr+1][sc])))return true;
             if(Math.abs(dc)===1&&dr===1&&targetColor==="white")return true; break;
    case"♖": case"♜": if(sr===tr||sc===tc) return clearPath(sr,sc,tr,tc); break;
    case"♗": case"♝": if(Math.abs(dr)===Math.abs(dc)) return clearPath(sr,sc,tr,tc); break;
    case"♕": case"♛": if(sr===tr||sc===tc||Math.abs(dr)===Math.abs(dc)) return clearPath(sr,sc,tr,tc); break;
    case"♘": case"♞": if((Math.abs(dr)===2&&Math.abs(dc)===1)||(Math.abs(dr)===1&&Math.abs(dc)===2)) return true; break;
    case"♔": case"♚": if(Math.abs(dr)<=1&&Math.abs(dc)<=1) return true; break;
  }
  return false;
}

function clearPath(sr,sc,tr,tc){
  const stepR=Math.sign(tr-sr),stepC=Math.sign(tc-sc);
  let r=sr+stepR,c=sc+stepC;
  while(r!==tr||c!==tc){
    if(boardState[r][c])return false;
    r+=stepR;c+=stepC;
  }
  return true;
}

function getMoves(r,c){
  const moves=[];
  for(let i=0;i<8;i++){
    for(let j=0;j<8;j++){
      if(isValidMove(r,c,i,j))moves.push([i,j]);
    }
  }
  return moves;
}

restartBtn.onclick=()=>{
  boardState=JSON.parse(JSON.stringify(initialBoard));
  currentPlayer="white";
  gameOver=false;
  turnText.textContent=`Vez das brancas ⚪`;
  renderBoard();
};

renderBoard();
</script>
</body>
</html>
