<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xadrez: Evo Edition Final</title>
<style>
body { font-family:sans-serif; display:flex; flex-direction:column; align-items:center; background:#1e1e2f; color:white; min-height:100vh; margin:0; }
h1 { margin:20px 0; color:#ffcc00; text-shadow:2px 2px #000; }
#evoSelection { display:flex; flex-direction:column; align-items:center; margin-top:20px; }
.cards { display:flex; gap:15px; flex-wrap:wrap; justify-content:center; margin:15px 0; }
.card { padding:15px 20px; border-radius:12px; background:#2b2b3b; border:2px solid #555; cursor:pointer; text-align:center; min-width:80px; font-weight:bold; transition:0.3s; }
.card:hover { transform:scale(1.1); border-color:#ffcc00; box-shadow:0 0 15px #ffcc00; }
.selectedCard { border-color:#00ff88; background-color:#44445a; box-shadow:0 0 10px #00ff88; }
#evoInfo { margin-top:10px; font-size:14px; min-height:30px; color:#ffdd55; text-align:center; }
button { padding:12px 25px; font-size:16px; cursor:pointer; margin-top:10px; border-radius:10px; border:none; background:linear-gradient(90deg,#ffcc00,#ffaa00); color:#000; font-weight:bold; transition:0.3s; }
button:hover { transform:scale(1.05); background:linear-gradient(90deg,#ffaa00,#ffcc00); }
#board { display:grid; grid-template-columns:repeat(8,60px); grid-template-rows:repeat(8,60px); margin-top:20px; border:3px solid #fff; }
.cell { width:60px; height:60px; display:flex; justify-content:center; align-items:center; font-size:30px; cursor:pointer; user-select:none; transition:0.2s; }
.white { background-color:#eee; color:#000; }
.black { background-color:#444; color:#fff; }
.move { background-color:#ffff55 !important; }
.highlight { box-shadow:0 0 8px #00ff88 inset; }
#info { margin-top:15px; text-align:center; font-size:16px; }
</style>
</head>
<body>

<h1>Xadrez: Evo Edition Final</h1>

<div id="evoSelection">
  <p id="playerPrompt">Escolha 2 evoluções para o jogador Branco:</p>
  <div class="cards" id="cardsContainer"></div>
  <div id="evoInfo"></div>
  <button id="confirmEvo">Confirmar</button>
</div>

<div id="boardContainer" style="display:none;">
  <div id="board"></div>
  <div id="info">
    <p id="turn">Turno: Branco</p>
    <p id="selected">Peça selecionada: Nenhuma</p>
  </div>
</div>

<script>
// ===== EVOS =====
const evolutions = ["Peão","Cavalo","Bispo","Torre","Rainha","Rei"];
const evoDescriptions = {
  "Peão":"Avança 2 casas ou ataca em área | Ciclos:2",
  "Cavalo":"Salto em L | Ciclos:3",
  "Bispo":"Troca de posição ou ataca sem se mover | Ciclos:4",
  "Torre":"Dash em linha, para ao capturar | Ciclos:3",
  "Rainha":"Combo em linha ou diagonal | Ciclos:4",
  "Rei":"Protege peças ou troca de lugar | Ciclos:2"
};
let playerEvos = {white: [], black: []};
let evoTurn = 'white';
let selectedEvos = [];

// ===== ELEMENTOS =====
const cardsContainer = document.getElementById('cardsContainer');
const evoInfo = document.getElementById('evoInfo');
const playerPrompt = document.getElementById('playerPrompt');
const confirmButton = document.getElementById('confirmEvo');
const boardContainer = document.getElementById('boardContainer');
const board = document.getElementById('board');
const turnDisplay = document.getElementById('turn');
const selectedDisplay = document.getElementById('selected');

// ===== TABULEIRO =====
let boardState = [];
let currentPlayer = 'white';
let selectedPiece = null;
let skillReady = {};

// ===== SETUP INICIAL =====
const initialSetup = [
  ['r','n','b','q','k','b','n','r'],
  ['p','p','p','p','p','p','p','p'],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['','','','','','','',''],
  ['P','P','P','P','P','P','P','P'],
  ['R','N','B','Q','K','B','N','R']
];

// ===== EVOS =====
function showEvoCards() {
  cardsContainer.innerHTML='';
  evolutions.forEach(evo=>{
    const card=document.createElement('div');
    card.classList.add('card');
    card.textContent=evo;
    card.addEventListener('click', ()=>selectEvo(evo, card));
    cardsContainer.appendChild(card);
  });
}

function selectEvo(evo, card){
  if(selectedEvos.includes(evo)){
    selectedEvos = selectedEvos.filter(e=>e!==evo);
    card.classList.remove('selectedCard');
  } else if(selectedEvos.length<2){
    selectedEvos.push(evo);
    card.classList.add('selectedCard');
  }
  evoInfo.textContent = selectedEvos.map(e=>evoDescriptions[e]).join(' | ');
}

confirmButton.addEventListener('click', ()=>{
  if(selectedEvos.length!==2) return alert("Escolha 2 evoluções!");
  playerEvos[evoTurn] = [...selectedEvos];
  selectedEvos=[];
  evoInfo.textContent='';
  if(evoTurn==='white'){
    evoTurn='black';
    playerPrompt.textContent="Escolha 2 evoluções para o jogador Preto:";
    showEvoCards();
  } else {
    document.getElementById('evoSelection').style.display='none';
    boardContainer.style.display='block';
    createBoard();
  }
});

// ===== TABULEIRO =====
function createBoard(){
  board.innerHTML='';
  boardState = JSON.parse(JSON.stringify(initialSetup));
  skillReady={};
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const cell=document.createElement('div');
      cell.classList.add('cell', (r+c)%2===0?'white':'black');
      cell.dataset.row=r;
      cell.dataset.col=c;
      cell.textContent=boardState[r][c];
      cell.addEventListener('click', handleCellClick);
      board.appendChild(cell);
      if(boardState[r][c]) skillReady[`${r}_${c}`]={ready:false, cycles:0, movedThisTurn:false};
    }
  }
  currentPlayer='white';
  turnDisplay.textContent='Turno: Branco';
  selectedPiece=null;
  selectedDisplay.textContent='Peça selecionada: Nenhuma';
  clearHighlights();
}

// ===== MOVIMENTOS =====
function isAlly(piece){ if(!piece) return false; return (currentPlayer==='white' && piece===piece.toUpperCase()) || (currentPlayer==='black' && piece===piece.toLowerCase()); }
function isEnemy(piece){ if(!piece) return false; return (currentPlayer==='white' && piece===piece.toLowerCase()) || (currentPlayer==='black' && piece===piece.toUpperCase()); }
function getPieceName(p){ switch(p.toUpperCase()){case 'P':return 'Peão';case 'R':return 'Torre';case 'N':return 'Cavalo';case 'B':return 'Bispo';case 'Q':return 'Rainha';case 'K':return 'Rei';default:return 'Desconhecido';} }

function handleCellClick(e){
  const r=parseInt(e.currentTarget.dataset.row);
  const c=parseInt(e.currentTarget.dataset.col);
  const piece=boardState[r][c];

  if(selectedPiece && e.currentTarget.classList.contains('move')){
    movePiece(r,c);
    return;
  }

  if(piece && isAlly(piece)){
    selectedPiece={row:r,col:c,piece:piece};
    selectedDisplay.textContent=`Peça selecionada: ${getPieceName(piece)}`;
    showPossibleMoves(r,c);
  } else {
    clearHighlights();
    selectedPiece=null;
    selectedDisplay.textContent='Peça selecionada: Nenhuma';
  }
}

function movePiece(r,c){
  const oldR=selectedPiece.row;
  const oldC=selectedPiece.col;
  const target=boardState[r][c];

  if(target && target.toUpperCase()==='K'){
    alert(`${currentPlayer.charAt(0).toUpperCase()+currentPlayer.slice(1)} venceu!`);
    createBoard();
    return;
  }

  boardState[r][c]=selectedPiece.piece;
  boardState[oldR][oldC]='';
  updateBoard();
  selectedPiece=null;
  selectedDisplay.textContent='Peça selecionada: Nenhuma';
  switchTurn();
}

function updateBoard(){
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      board.children[r*8+c].textContent = boardState[r][c];
    }
  }
}

function showPossibleMoves(r,c){
  clearHighlights();
  const piece=boardState[r][c];
  const type=piece.toUpperCase();
  let moves=[];
  const color = piece===piece.toUpperCase()?'white':'black';
  const isEvo = playerEvos[color].includes(getPieceName(piece));

  if(type==='P'){ 
    const dir = piece===piece.toUpperCase()? -1:1;
    // Avanço 1 casa
    if(r+dir>=0 && r+dir<8 && !boardState[r+dir][c]) moves.push([r+dir,c]);
    // Avanço 2 casas no início
    if((r===6 && color==='white')||(r===1 && color==='black')){
      if(!boardState[r+dir][c] && !boardState[r+dir*2][c]) moves.push([r+dir*2,c]);
    }
    // Captura diagonal
    [[1,1],[1,-1]].forEach(d=>{
      const nr=r+dir, nc=c+d[1];
      if(nr>=0 && nr<8 && nc>=0 && nc<8 && isEnemy(boardState[nr][nc])) moves.push([nr,nc]);
    });
  } else if(type==='N'){
    const dirs=[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]];
    dirs.forEach(d=>{const nr=r+d[0], nc=c+d[1]; if(nr>=0 && nr<8 && nc>=0 && nc<8 && !isAlly(boardState[nr][nc])) moves.push([nr,nc]);});
  } else if(type==='B'){
    const dirs=[[1,1],[1,-1],[-1,1],[-1,-1]];
    dirs.forEach(d=>{
      let nr=r+d[0], nc=c+d[1];
      while(nr>=0 && nr<8 && nc>=0 && nc<8){
        if(isAlly(boardState[nr][nc])) break;
        moves.push([nr,nc]);
        if(isEnemy(boardState[nr][nc])) break;
        nr+=d[0]; nc+=d[1];
      }
    });
  } else if(type==='R'){
    const dirs=[[1,0],[-1,0],[0,1],[0,-1]];
    dirs.forEach(d=>{
      let nr=r+d[0], nc=c+d[1];
      while(nr>=0 && nr<8 && nc>=0 && nc<8){
        if(isAlly(boardState[nr][nc])) break;
        moves.push([nr,nc]);
        if(isEnemy(boardState[nr][nc])) break;
        nr+=d[0]; nc+=d[1];
      }
    });
  } else if(type==='Q'){
    const dirs=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];
    dirs.forEach(d=>{
      let nr=r+d[0], nc=c+d[1];
      while(nr>=0 && nr<8 && nc>=0 && nc<8){
        if(isAlly(boardState[nr][nc])) break;
        moves.push([nr,nc]);
        if(isEnemy(boardState[nr][nc])) break;
        nr+=d[0]; nc+=d[1];
      }
    });
  } else if(type==='K'){
    const dirs=[[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]];
    dirs.forEach(d=>{
      const nr=r+d[0], nc=c+d[1];
      if(nr>=0 && nr<8 && nc>=0 && nc<8 && !isAlly(boardState[nr][nc])){
        moves.push([nr,nc]);
      }
    });
  }

  // Highlight das casas possíveis
  moves.forEach(m=>{
    const idx=m[0]*8+m[1];
    board.children[idx].classList.add('move');
    if(isEvo) board.children[idx].classList.add('highlight');
  });
}

function clearHighlights(){
  for(let cell of board.children){
    cell.classList.remove('move','highlight');
  }
}

function switchTurn(){
  currentPlayer = currentPlayer==='white'?'black':'white';
  turnDisplay.textContent = `Turno: ${currentPlayer.charAt(0).toUpperCase()+currentPlayer.slice(1)}`;
  selectedPiece=null;
  selectedDisplay.textContent='Peça selecionada: Nenhuma';
  clearHighlights();
}

// Inicia seleção de EVOS
showEvoCards();
</script>

</body>
</html>
